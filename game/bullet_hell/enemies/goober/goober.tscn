[gd_scene load_steps=18 format=3 uid="uid://5ey5xirm8gah"]

[ext_resource type="Script" path="res://bullet_hell/enemies/goober/goober.gd" id="1_3o1gh"]
[ext_resource type="Script" path="res://components/states/state_machine.gd" id="2_85xb7"]
[ext_resource type="Texture2D" uid="uid://dmmadcrn8ay1x" path="res://assets/textures/circle-filled.png" id="2_g3k4c"]
[ext_resource type="Script" path="res://bullet_hell/enemies/goober/states/approach.gd" id="3_cjir6"]
[ext_resource type="Script" path="res://bullet_hell/enemies/goober/states/charge_up.gd" id="4_t3a6m"]
[ext_resource type="Script" path="res://bullet_hell/enemies/goober/states/fire.gd" id="5_ymon6"]
[ext_resource type="AudioStream" uid="uid://cj22thlejgkgk" path="res://assets/sounds/saw-bounce.wav" id="6_qm7nk"]

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_vwrpc"]
rough = true
bounce = 1.0

[sub_resource type="AudioStreamRandomizer" id="AudioStreamRandomizer_518vd"]
random_pitch = 1.25
random_volume_offset_db = 2.5
streams_count = 1
stream_0/stream = ExtResource("6_qm7nk")
stream_0/weight = 1.0

[sub_resource type="Curve" id="Curve_7yros"]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 2

[sub_resource type="CurveTexture" id="CurveTexture_p45wa"]
curve = SubResource("Curve_7yros")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_6k2ns"]
particle_flag_disable_z = true
emission_shape = 1
emission_sphere_radius = 2.0
spread = 0.0
initial_velocity_max = 50.0
gravity = Vector3(0, 0, 0)
scale_min = 0.01
scale_max = 0.05
scale_curve = SubResource("CurveTexture_p45wa")

[sub_resource type="Curve" id="Curve_kuxwl"]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 2

[sub_resource type="CurveTexture" id="CurveTexture_vqqk3"]
curve = SubResource("Curve_kuxwl")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_6yxfn"]
particle_flag_disable_z = true
direction = Vector3(-1, 0, 0)
spread = 15.0
initial_velocity_min = 25.0
initial_velocity_max = 100.0
gravity = Vector3(0, 0, 0)
scale_min = 0.01
scale_max = 0.05
scale_curve = SubResource("CurveTexture_vqqk3")

[sub_resource type="RectangleShape2D" id="RectangleShape2D_7g8jo"]
size = Vector2(24, 16)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_cmpf4"]
size = Vector2(24, 16)

[node name="Goober" type="RigidBody2D" node_paths=PackedStringArray("bullet_spawner", "bullet_charge", "thruster")]
collision_layer = 16
physics_material_override = SubResource("PhysicsMaterial_vwrpc")
gravity_scale = 0.0
max_contacts_reported = 4
contact_monitor = true
script = ExtResource("1_3o1gh")
bullet_spawner = NodePath("BulletSpawner")
bullet_charge = NodePath("BulletSpawner/Charge")
thruster = NodePath("Tail/Thruster")

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("2_85xb7")
initial_state = NodePath("Approach")

[node name="Approach" type="Node" parent="StateMachine"]
script = ExtResource("3_cjir6")

[node name="ChargeUp" type="Node" parent="StateMachine" node_paths=PackedStringArray("charge_timer")]
script = ExtResource("4_t3a6m")
charge_timer = NodePath("ChargeTimer")

[node name="ChargeTimer" type="Timer" parent="StateMachine/ChargeUp"]
wait_time = 2.0
one_shot = true

[node name="Fire" type="Node" parent="StateMachine" node_paths=PackedStringArray("stun_timer", "fire_sound")]
script = ExtResource("5_ymon6")
stun_timer = NodePath("StunTimer")
fire_sound = NodePath("FireSound")

[node name="StunTimer" type="Timer" parent="StateMachine/Fire"]
wait_time = 4.0
one_shot = true

[node name="FireSound" type="AudioStreamPlayer" parent="StateMachine/Fire"]
stream = SubResource("AudioStreamRandomizer_518vd")
bus = &"sfx"

[node name="Shape" type="Polygon2D" parent="."]
modulate = Color(1, 0, 0, 1)
polygon = PackedVector2Array(0, -8, -8, 0, 0, 8, 12, 2, 9, 2, 7, 0, 9, -2, 12, -2)

[node name="Fill" type="Polygon2D" parent="Shape"]
color = Color(0, 0, 0, 1)
polygon = PackedVector2Array(0, -6, -6, 0, 0, 6, 6, 0)

[node name="Pupil" type="Polygon2D" parent="Shape/Fill"]
polygon = PackedVector2Array(1, -2, -1, 0, 1, 2, 3, 0)

[node name="Fin1" type="Polygon2D" parent="Shape"]
polygon = PackedVector2Array(-8, 1, -12, 4, -4, 5)

[node name="Fin2" type="Polygon2D" parent="Shape"]
polygon = PackedVector2Array(-8, -1, -12, -4, -4, -5)

[node name="BulletSpawner" type="Marker2D" parent="."]
position = Vector2(10, 0)

[node name="Charge" type="GPUParticles2D" parent="BulletSpawner"]
modulate = Color(1, 0, 0, 1)
emitting = false
amount = 50
process_material = SubResource("ParticleProcessMaterial_6k2ns")
texture = ExtResource("2_g3k4c")

[node name="Tail" type="Marker2D" parent="."]
position = Vector2(-9, 0)

[node name="Thruster" type="GPUParticles2D" parent="Tail"]
modulate = Color(1, 0, 0, 1)
emitting = false
amount = 50
process_material = SubResource("ParticleProcessMaterial_6yxfn")
texture = ExtResource("2_g3k4c")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("RectangleShape2D_7g8jo")

[node name="Owie" type="Area2D" parent="."]
collision_layer = 4
collision_mask = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="Owie"]
shape = SubResource("RectangleShape2D_cmpf4")

[connection signal="body_exited" from="." to="StateMachine/Fire" method="_on_goober_body_exited"]
[connection signal="timeout" from="StateMachine/ChargeUp/ChargeTimer" to="StateMachine/ChargeUp" method="_on_charge_timer_timeout"]
[connection signal="timeout" from="StateMachine/Fire/StunTimer" to="StateMachine/Fire" method="_on_stun_timer_timeout"]
